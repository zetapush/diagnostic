<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZetaPush Diagnostic</title>
    <style>.success{color:#5cb85c;}.error{color:#d9534f;}.info{color:#337ab7;}</style>
  </head>
  <body>
    <main>
      <h1>ZetaPush Diagnostic</h1>
      <ol></ol>
    </main>
    <script src="//unpkg.com/zetapush-js@3.0.1/dist/zetapush.min.js"></script>
    <script>
      (function () {
        var list = document.querySelector('ol')
        function log(message, level) {
          var item = document.createElement('li')
          item.textContent = message
          item.classList.add(level)
          list.appendChild(item)
        }
        function diagnostic(transport, name) {
          var client = new ZetaPush.WeakClient({
            sandboxId: 'mQPnwzCF',
            deploymentId: 'z3LE',
            transports: [transport]
          })
          client.addConnectionStatusListener({
            onConnectionBroken() { log(name + '::onConnectionBroken', 'error') },
            onConnectionClosed() { log(name + '::onConnectionClosed', 'info') },
            onConnectionEstablished() { log(name + '::onConnectionEstablished', 'success') },
            onConnectionWillClose() { log(name + '::onConnectionWillClose', 'info') },
            onFailedHandshake(error) { log(name + '::onFailedHandshake', 'error') },
            onMessageLost() { log(name + '::onMessageLost', 'error') },
            onSuccessfulHandshake(authentication) { log(name + '::onSuccessfulHandshake', 'success') }
          })
          client.setLogLevel('debug')
          client.connect()
        }
        diagnostic(ZetaPush.TransportTypes.LONG_POLLING, 'LongPolling')
        diagnostic(ZetaPush.TransportTypes.WEBSOCKET, 'WebSocket')
      }());
    </script>
  </body>
</html>
